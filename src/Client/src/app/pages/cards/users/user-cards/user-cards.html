<app-search 
[searchPlaceholder]="'EnterCardName'|translate"
[sortValues]="(sortValues$ |async) || []"
[filterValues]="(filterValues$ |async) || []"
(sortChange)="onSortChange($event)"
(searchChange)="onSearchChange($event)"
(filterChange)="onFiltersChange($event)"
(filterChange)="onFiltersChange($event)"
>
</app-search>

<app-cards-layout></app-cards-layout>


@if(isLoading()){
    <div class="spinner-wrapper">
      <app-loading></app-loading> 
    </div>
}

@else {
    @if(userCards?.items?.length===0){
        <h1 class="subheading-without-lh zero-items mb-4">{{'NoAvailableCards' |translate}}</h1>
    }
    <div class="cards-info" [class.with-last-child]="userCards !==null && userCards!.items.length%2 !==0 && userCards!.items.length>0">
        @for (card of userCards?.items; track $index) {
            <a [routerLink]="['/cards/my-card', card.id]" [class.blocked]="card.status===CardStatus.Blocked" [class.expired]="card.status===CardStatus.Expired"
                #card class="card-link" [style.background-color]="card.cardTariffs.cardColor" [attr.data-blocked-label]="'Blocked-Upper' | translate"
                [attr.data-expired-label]="'Expired-Upper' | translate">
                <div class="card-info-divider">
                    <div class="card-name">
                        <img class="card-bank-logo" src="assets/images/bank-logo.png" alt="">
                        <h1>{{card.cardTariffs.cardName}}</h1>
                    </div>
                    <div class="card-right-side">
                        <div class="payment-systems">
                            @if(card.chosedPaymentSystem===PaymentSystem.Visa){
                                <img src="assets/images/bank-products/payment-systems/visa.svg" class="visa" alt="Mastercard">
                            }
                            @if(card.chosedPaymentSystem===PaymentSystem.Mastercard){
                                <img src="assets/images/bank-products/payment-systems/mastercard.svg" alt="Mastercard">
                            }
                        </div>

                        <div class="card-type">
                            @if(card.cardTariffs.type===CardType.Credit){
                                <h4>{{'Credit' |translate}}</h4>
                            }
                            @else if(card.cardTariffs.type===CardType.Debit) {
                                <h4>{{'Debit' | translate}}</h4>
                            }
                        </div>
                    </div>
                </div>

                <div class="card-number">
                    {{ card.cardNumber | cardFormat}} 
                    <img class="copy-card-img"  (click)="copyCardNumber(card.cardNumber, $event)" src="assets/images/copy.svg" alt="Copy">
                </div>

                <div class="balance">
                    <span>{{(card.balance + card.creditLimit).toFixed(2)}} </span>
                    @switch (card.chosenCurrency) {
                        @case (Currency.UAH) {
                            <span>₴</span>
                        }
                        @case (Currency.USD) {
                            <span>$</span>
                        }
                        @case (Currency.EUR) {
                            <span>€</span>
                        
                        }
                        @default {}
                    }
                </div>
            </a>
        }
    </div>


    <div class="add-block">
        @if(userCards?.items?.length!>0){
            <button class="make-transfer" (click)="openTransactionWindow.set(true)">{{'MakeTransfer' |translate}}</button>
        }
        <a [routerLink]="['/cards/my-cards/add/options']" class="add-item">{{'OpenCard' |translate}}</a>
    </div>
}

@if(openTransactionWindow()){
    <app-transaction-window
    [cards]="userCards?.items"
    (cancelTransaction)="openTransactionWindow.set(false)"
    (makeTransaction)="makeTransaction($event)"
    ></app-transaction-window>
}

@if(success()){
    <app-success-message
        [message]="'Success' | translate"
        [secondMessage]="'CardCreated' | translate"
    >
    </app-success-message>
}
@if(copied()){
    <app-success-message
        [message]="'Success' | translate"
        [secondMessage]="'CardNumberCopied' | translate"
    >
    </app-success-message>
}
@if(successTransaction()){
    <app-success-message
        [message]="'Success' | translate"
        [secondMessage]="'TransactionCreated' | translate"
    >
    </app-success-message>
}
@if(showError()){
    <app-error-message
        message="Error!"
        [secondMessage]="errorMessage"
    >

    </app-error-message>
}

<app-page-switcher 
[currentPage]="userCards?.pageNumber"
[hasNextPage]="userCards?.hasNextPage"
[hasPreviousPage]="userCards?.hasPreviousPage"
[pageCount]="userCards?.pageCount"
(pageChange)="onPageChange($event)"
> </app-page-switcher>