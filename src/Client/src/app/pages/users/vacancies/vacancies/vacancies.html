<app-search
    #searchComponent
    searchPlaceholder="Enter job title"
    [sortValues]="sortValues"
    [filterValues]="filterValues"
    (searchChange)="onSearchChange($event)"
    (filterChange)="onFiltersChange($event)"
    (sortChange)="onSortChange($event)"
>

</app-search>
@if(profileService.getRole() !== "Admin"){
    <h1 class="heading info-header">{{'VacancyInfo' |translate}}</h1>

}


<section class="content-block">
    @if($vacancy | async; as vacanciesPage){
        @if(vacanciesPage.items.length ===0){
            <h1 class="heading">{{'NoVacancies' |translate}}</h1>
        }
        @else {
            @for(vacancy of vacanciesPage.items; track $index){
                <div class="vacancy-block">
                    <h1 class="subheading">{{vacancy.jobTitle}}</h1>
                    <span class="category">{{vacancy.category}}</span>
                    <hr>
                    <span class="salary">{{'Salary' |translate}}: {{vacancy.salary}}â‚´</span>

                    <div class="buttons">
                        @if(profileService.getRole() === "Admin"){
                            <a [routerLink]="['/vacancies/update/', vacancy.id]" class="apply-job">{{'UpdateVacancy' |translate}}</a>
                            <button class="delete-vacancy" (click)="openDeleteWindow(vacancy.id!, vacancy.jobTitle)">{{'DeleteVacancy' | translate}}</button>

                        }
                        @else {
                            <button class="apply-job" (click)="openApplyForJobWindow(vacancy.id!)">{{'ApplyForJob'|translate}}</button>
                        }

                    </div>
                </div>
            }
        }
    }
    @else{
        <app-loading></app-loading>
    }
</section>

@if($vacancy | async; as vacanciesPage){
    <app-page-switcher 
    [currentPage]="vacanciesPage.pageNumber"
    [hasNextPage]="vacanciesPage.hasNextPage"
    [hasPreviousPage]="vacanciesPage.hasPreviousPage"
    [pageCount]="vacanciesPage.pageCount"
    (pageChange)="onPageChange($event)"
    > </app-page-switcher>
}


@if(profileService.getRole() === "Admin"){
    <div class="add-block">
        <a [routerLink]="['/vacancies/add']" class="add-item">{{'AddVacancy' |translate}}</a>
    </div>      
}

@if(showDeleteWindow()){
    <app-confirm-delete
        [itemName]="deleteText"
        (cancel)="cancelDelete()"
        (confirm)="confirmDelete()"
    ></app-confirm-delete>
}

@if(showSuccessWindow()){
    <app-success-message
        message="Success!"
        [secondMessage]="successMessage!"
    ></app-success-message>
}
@if(showErrorWindow()){
    <app-error-message
        message="Error!"
        [secondMessage]="errorMessage!"
    >
    </app-error-message>
}
@if(showApplyForJobWindow()){
    <app-confirm-window
        title="Apply For a Job"
        subtitle="Are you sure you want to work in a bank?"
        (cancelAction)="cancelApplyForJob()"
        (confirmAction)="applyForJob()"
    >

    </app-confirm-window>
}